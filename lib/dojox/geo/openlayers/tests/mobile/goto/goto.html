<html>
<head profile="http://www.w3.org/2002/12/namespace">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<title>Go To</title>

<link rel="stylesheet" type="text/css" href="../../../../../../dojox/mobile/themes/iphone/iphone.css">
<!--		<link rel="stylesheet" type="text/css" href="../../../../../../dojox/mobile/themes/android/android.css">-->
<!-- 
<link href="../../../../../../dojox/mobile/themes/buttons.css" rel="stylesheet"></link>
<link href="../../../../../../dojox/mobile/themes/buttons-compat.css" rel="stylesheet"></link>
 -->

<!-- hosted version -->
<script type="text/javascript" src="http://openlayers.org/api/OpenLayers.js"></script>

<script type="text/javascript">
	var djConfig = {
    async: true,
		isDebug : true,
		parseOnLoad : true
	};
</script>

<script type="text/javascript" src="../../../../../../dojo/dojo.js"></script>

<script type="text/javascript">

//	dojo.require("dojox.geo.openlayers.widget.Map");
//	dojo.require("dojox.mobile.parser");
//	dojo.require("dojox.mobile");
//	dojo.requireIf(!dojo.isWebKit, "dojox.mobile.compat");
//	dojo.require("dojox.geo.openlayers.tests.mobile.goto.NavigationControl");

require(["dojox/mobile", "dojox/mobile/parser", "dojox/geo/openlayers/widget/Map",
 "dojox/geo/openlayers/tests/mobile/goto/NavigationControl"], 
  function(mobileArg, parserArg, mapArg, controlArg){

	var map;
    var currentLocation;

	dojo.addOnLoad(function(){
		var options = {
			baseLayerName : "TheMap",
			touchHandler : true,
            baseLayerType : dojox.geo.openlayers.BaseLayerType.ARCGIS
		};

		map = new dojox.geo.openlayers.widget.Map(options);
    
		dojo.place(map.domNode, "map");
		map.startup();

		var olMap = map.map.getOLMap();
		var ctrl = new controlArg({
			dojoMap : map
		});
		olMap.addControl(ctrl);
		var mapPage = dijit.byId("mapPage");
		dojo.connect(mapPage, "onAfterTransitionIn", mapPage, afterTransition);

		var paris = dijit.byId("paris");
		dojo.connect(paris, "onClick", paris, click);

		var ny = dijit.byId("newyork");
		dojo.connect(ny, "onClick", ny, click);

		var lc = dijit.byId("lacolle");
		dojo.connect(lc, "onClick", lc, click);

        dojo.connect(window, "onresize", resize); 
	});

	function beforeTransition(){

	}
  
	function afterTransition(){
      fitTo();
	}

    function resize() {
      setTimeout(updateMap, 0);
    }

	var locs = {
		paris : [ 2.350833, 48.856667, 10 ],
		newyork : [ -74.00597, 40.71427, 11 ],
		lacolle : [ 7.1072435, 43.686842, 15 ]
	};

	function click(e){
      currentLocation = this.id;
	}

	function fitTo(loc){
      if(!loc)
        loc = currentLocation;
      var l = locs[loc];
	  var p = map.map.transformXY(l[0], l[1]);
	  var ll = new OpenLayers.LonLat(p.x, p.y);
      var olm = map.map.getOLMap();
      var center = ll;
      var zoom = l[2];
      olm.zoom = null; 
	  olm.setCenter(center, zoom);
	}

	function updateMap(){
	  var olm = map.map.getOLMap();
	  var center = olm.getCenter();
	  if (center != null) {
		var zoom = olm.getZoom();
		olm.zoom = null;
		olm.setCenter(center, zoom);
	  }
	}
  });
  
</script>

</head>
<body class="tundra">

  <div id="home" dojoType="dojox.mobile.View" selected="true" style="width: 100%; height: 100%;">
    <h1 dojoType="dojox.mobile.Heading">GoTo</h1>
    <h2 dojoType="dojox.mobile.RoundRectCategory">Go To:</h2>
    <ul dojoType="dojox.mobile.RoundRectList">
      <li id="paris" dojoType="dojox.mobile.ListItem" moveTo="mapPage" transition="slide">Paris</li>
      <li id="newyork" dojoType="dojox.mobile.ListItem" moveTo="mapPage" transition="flip">New York</li>
      <li id="lacolle" dojoType="dojox.mobile.ListItem" moveTo="mapPage" transition="fade">La Colle sur Loup</li>
    </ul>
  </div>

  <div id="mapPage" dojoType="dojox.mobile.View" style="width: 100%; height: 100%;">
    <h1 dojoType="dojox.mobile.Heading" back="Home" moveTo="home">Map</h1>
    <div id="map" style="background-color: #b5d0d0; width: 100%; height: 100%;"></div>
  </div>
</body>
</html>

